<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPTV Player Pro - Com Salvamento</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Roboto', sans-serif;
        }

        :root {
            --primary: #3498db;
            --primary-dark: #2980b9;
            --secondary: #2c3e50;
            --success: #27ae60;
            --danger: #e74c3c;
            --warning: #f39c12;
            --info: #17a2b8;
            --dark: #1a1a2e;
            --light: #f8f9fa;
            --gray: #6c757d;
            --card-bg: #ffffff;
            --sidebar-width: 380px;
        }

        body.dark-mode {
            --light: #121212;
            --card-bg: #1e1e1e;
            --dark: #0a0a0a;
            --gray: #aaa;
        }

        body {
            background: var(--light);
            color: #333;
            min-height: 100vh;
            transition: background 0.3s;
        }

        body.dark-mode {
            color: #f0f0f0;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--secondary) 0%, var(--dark) 100%);
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 15px rgba(0,0,0,0.2);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            font-size: 1.8rem;
        }

        .logo h1 {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .logo span {
            color: var(--primary);
        }

        .header-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .status-badge {
            padding: 0.5rem 1rem;
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
            backdrop-filter: blur(10px);
        }

        .status-badge.connected {
            background: rgba(39, 174, 96, 0.2);
            color: #27ae60;
        }

        .status-badge.disconnected {
            background: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
        }

        /* Main Layout */
        .main-container {
            display: flex;
            min-height: calc(100vh - 70px);
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--card-bg);
            border-right: 1px solid rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            transition: all 0.3s;
            overflow: hidden;
        }

        body.dark-mode .sidebar {
            border-right-color: rgba(255,255,255,0.1);
        }

        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }

        body.dark-mode .sidebar-header {
            border-bottom-color: rgba(255,255,255,0.1);
        }

        .tabs {
            display: flex;
            gap: 5px;
            background: rgba(0,0,0,0.05);
            padding: 5px;
            border-radius: 10px;
            margin-bottom: 1rem;
        }

        body.dark-mode .tabs {
            background: rgba(255,255,255,0.05);
        }

        .tab {
            flex: 1;
            padding: 0.8rem 1rem;
            text-align: center;
            cursor: pointer;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s;
            color: var(--gray);
        }

        .tab.active {
            background: var(--primary);
            color: white;
        }

        .tab-content {
            padding: 1.5rem;
            flex: 1;
            overflow-y: auto;
        }

        /* Saved Lists */
        .saved-lists-section {
            margin-top: 1.5rem;
            border-top: 1px solid rgba(0,0,0,0.1);
            padding-top: 1.5rem;
        }

        body.dark-mode .saved-lists-section {
            border-top-color: rgba(255,255,255,0.1);
        }

        .saved-lists-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .saved-list-item {
            padding: 1rem;
            margin-bottom: 0.5rem;
            background: rgba(0,0,0,0.03);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 4px solid transparent;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        body.dark-mode .saved-list-item {
            background: rgba(255,255,255,0.05);
        }

        .saved-list-item:hover {
            background: rgba(52, 152, 219, 0.1);
            border-left-color: var(--primary);
        }

        .saved-list-item.active {
            background: rgba(52, 152, 219, 0.2);
            border-left-color: var(--primary);
        }

        .list-info {
            flex: 1;
        }

        .list-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .list-meta {
            font-size: 0.85rem;
            color: var(--gray);
            display: flex;
            gap: 1rem;
        }

        .list-actions {
            display: flex;
            gap: 5px;
        }

        .action-btn {
            padding: 5px 10px;
            background: rgba(0,0,0,0.1);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
            color: var(--gray);
            transition: all 0.3s;
        }

        body.dark-mode .action-btn {
            background: rgba(255,255,255,0.1);
        }

        .action-btn:hover {
            background: var(--primary);
            color: white;
        }

        /* Form Groups */
        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--secondary);
        }

        body.dark-mode .form-group label {
            color: #f0f0f0;
        }

        .form-control {
            width: 100%;
            padding: 0.8rem 1rem;
            border: 2px solid rgba(0,0,0,0.1);
            border-radius: 8px;
            font-size: 0.95rem;
            transition: border-color 0.3s;
            background: var(--card-bg);
            color: inherit;
        }

        body.dark-mode .form-control {
            border-color: rgba(255,255,255,0.1);
            background: rgba(255,255,255,0.05);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* Buttons */
        .btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 0.95rem;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #229954;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.3);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
        }

        .btn-info {
            background: var(--info);
            color: white;
        }

        .btn-info:hover {
            background: #138496;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(23, 162, 184, 0.3);
        }

        .btn-block {
            width: 100%;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        /* Channels List */
        .channels-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .channels-header {
            padding: 1.5rem;
            border-bottom: 1px solid rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        body.dark-mode .channels-header {
            border-bottom-color: rgba(255,255,255,0.1);
        }

        .channels-list {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }

        .channel-item {
            padding: 1rem;
            margin-bottom: 0.5rem;
            background: var(--card-bg);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 4px solid transparent;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        body.dark-mode .channel-item {
            background: rgba(255,255,255,0.05);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .channel-item:hover {
            transform: translateX(5px);
            border-left-color: var(--primary);
        }

        .channel-item.active {
            background: rgba(52, 152, 219, 0.1);
            border-left-color: var(--primary);
        }

        body.dark-mode .channel-item.active {
            background: rgba(52, 152, 219, 0.2);
        }

        .channel-logo {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            object-fit: cover;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .channel-info {
            flex: 1;
        }

        .channel-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .channel-category {
            font-size: 0.85rem;
            color: var(--gray);
        }

        /* Player Area */
        .player-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 2rem;
            gap: 2rem;
            min-width: 0;
        }

        .video-container {
            background: var(--dark);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            position: relative;
            aspect-ratio: 16/9;
        }

        #videoPlayer {
            width: 100%;
            height: 100%;
            display: block;
        }

        .player-controls-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.8));
            padding: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .video-container:hover .player-controls-overlay {
            opacity: 1;
        }

        .control-btn {
            background: rgba(255,255,255,0.1);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            font-size: 1.2rem;
        }

        .control-btn:hover {
            background: rgba(255,255,255,0.2);
            transform: scale(1.1);
        }

        .volume-slider {
            width: 100px;
            height: 4px;
            -webkit-appearance: none;
            background: rgba(255,255,255,0.2);
            border-radius: 2px;
            outline: none;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
        }

        /* Channel Info */
        .channel-info-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        body.dark-mode .channel-info-card {
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .channel-info-header {
            margin-bottom: 1rem;
        }

        .channel-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--primary);
        }

        .channel-meta {
            display: flex;
            gap: 2rem;
            flex-wrap: wrap;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--gray);
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            background: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 12px;
            transform: translateX(400px);
            transition: transform 0.3s;
            z-index: 1000;
            max-width: 400px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            border-left: 4px solid var(--success);
        }

        .notification.error {
            border-left: 4px solid var(--danger);
        }

        .notification.info {
            border-left: 4px solid var(--primary);
        }

        .notification.warning {
            border-left: 4px solid var(--warning);
        }

        .notification-icon {
            font-size: 1.2rem;
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .notification-message {
            font-size: 0.9rem;
            color: var(--gray);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 2rem;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        .modal-header {
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        .modal-body {
            margin-bottom: 2rem;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* Loading */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .main-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                max-height: 600px;
            }
            
            .player-area {
                padding: 1rem;
            }
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 1rem;
                padding: 1rem;
            }
            
            .channel-meta {
                flex-direction: column;
                gap: 1rem;
            }
            
            .notification {
                left: 20px;
                right: 20px;
                max-width: none;
            }
            
            .btn-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="logo">
            <div class="logo-icon">üì∫</div>
            <h1>IPTV <span>Player Pro</span></h1>
        </div>
        <div class="header-controls">
            <button class="btn btn-info" onclick="toggleTheme()">
                <span id="themeIcon">üåô</span> Tema
            </button>
            <div class="status-badge disconnected" id="statusBadge">
                <span>‚óè</span> Desconectado
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="tabs">
                    <div class="tab active" onclick="switchTab('m3u')">M3U Playlist</div>
                    <div class="tab" onclick="switchTab('xtream')">Xtream Codes</div>
                    <div class="tab" onclick="switchTab('saved')">Listas Salvas</div>
                </div>
            </div>

            <!-- M3U Tab -->
            <div class="tab-content" id="m3uTab">
                <div class="form-group">
                    <label for="m3uFile">üìÅ Arquivo M3U</label>
                    <input type="file" id="m3uFile" accept=".m3u,.m3u8" class="form-control">
                </div>
                <div class="form-group">
                    <label for="m3uUrl">üîó URL da Lista M3U</label>
                    <input type="text" id="m3uUrl" placeholder="https://exemplo.com/lista.m3u" class="form-control">
                </div>
                <div class="form-group">
                    <label for="listName">üè∑Ô∏è Nome da Lista (opcional)</label>
                    <input type="text" id="listName" placeholder="Minha Lista IPTV" class="form-control">
                </div>
                <button class="btn btn-success btn-block" onclick="loadDemo()">
                    üöÄ CARREGAR DEMO FUNCIONAL
                </button>
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="loadM3U()" style="flex: 2;">
                        üì§ Carregar Lista
                    </button>
                    <button class="btn btn-info" onclick="saveCurrentList()" style="flex: 1;">
                        üíæ Salvar
                    </button>
                </div>
            </div>

            <!-- Xtream Tab -->
            <div class="tab-content" id="xtreamTab" style="display: none;">
                <div class="form-group">
                    <label for="serverUrl">üåê URL do Servidor</label>
                    <input type="text" id="serverUrl" placeholder="http://servidor.com:8080" class="form-control">
                </div>
                <div class="form-group">
                    <label for="username">üë§ Usu√°rio</label>
                    <input type="text" id="username" placeholder="Seu usu√°rio" class="form-control">
                </div>
                <div class="form-group">
                    <label for="password">üîí Senha</label>
                    <input type="password" id="password" placeholder="Sua senha" class="form-control">
                </div>
                <div class="form-group">
                    <label for="xtreamListName">üè∑Ô∏è Nome da Lista (opcional)</label>
                    <input type="text" id="xtreamListName" placeholder="Xtream IPTV" class="form-control">
                </div>
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="connectXtream()" style="flex: 2;">
                        üîå Conectar
                    </button>
                    <button class="btn btn-info" onclick="saveXtreamList()" style="flex: 1;">
                        üíæ Salvar
                    </button>
                </div>
            </div>

            <!-- Saved Lists Tab -->
            <div class="tab-content" id="savedTab" style="display: none;">
                <div class="saved-lists-header">
                    <h3>üìö Listas Salvas</h3>
                    <button class="btn btn-danger btn-sm" onclick="clearAllLists()">
                        üóëÔ∏è Limpar Tudo
                    </button>
                </div>
                <div id="savedListsContainer">
                    <!-- Listas salvas ser√£o carregadas aqui -->
                </div>
                <div style="text-align: center; margin-top: 2rem; color: var(--gray);">
                    <p>üí° Dica: Salve suas listas para acessar rapidamente depois!</p>
                </div>
            </div>

            <!-- Channels List -->
            <div class="channels-section">
                <div class="channels-header">
                    <h3>Canais (<span id="channelCount">0</span>)</h3>
                    <select class="form-control" id="categoryFilter" style="width: auto; padding: 0.5rem 1rem;">
                        <option value="all">Todas categorias</option>
                    </select>
                </div>
                <div class="channels-list" id="channelsList">
                    <!-- Channels will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Player Area -->
        <div class="player-area">
            <div class="video-container">
                <video id="videoPlayer" controls playsinline>
                    Seu navegador n√£o suporta o player de v√≠deo.
                </video>
                <div class="player-controls-overlay">
                    <button class="control-btn" onclick="playPause()" id="playBtn">
                        ‚ñ∂Ô∏è
                    </button>
                    <button class="control-btn" onclick="toggleMute()" id="muteBtn">
                        üîä
                    </button>
                    <input type="range" class="volume-slider" id="volumeSlider" min="0" max="1" step="0.1" value="1">
                    <button class="control-btn" onclick="toggleFullscreen()">
                        ‚õ∂
                    </button>
                </div>
            </div>

            <div class="channel-info-card">
                <div class="channel-info-header">
                    <h2 id="currentChannelTitle">Selecione um canal</h2>
                    <p id="currentChannelDesc">Carregue a demo ou sua lista M3U para come√ßar</p>
                </div>
                <div class="channel-meta">
                    <div class="meta-item">
                        <span>üìÅ</span>
                        <span id="currentCategory">Categoria: -</span>
                    </div>
                    <div class="meta-item">
                        <span>üì∂</span>
                        <span id="currentStatus">Status: Aguardando</span>
                    </div>
                    <div class="meta-item">
                        <span>‚è±Ô∏è</span>
                        <span id="currentDuration">Dura√ß√£o: -</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Save List Modal -->
    <div class="modal" id="saveModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">üíæ Salvar Lista</h3>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="saveListName">Nome da Lista</label>
                    <input type="text" id="saveListName" class="form-control" placeholder="Minha Lista IPTV">
                </div>
                <div class="form-group">
                    <label for="saveListType">Tipo de Lista</label>
                    <select id="saveListType" class="form-control">
                        <option value="m3u">M3U Playlist</option>
                        <option value="xtream">Xtream Codes</option>
                        <option value="demo">Lista Demo</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeSaveModal()">Cancelar</button>
                <button class="btn btn-success" onclick="confirmSaveList()">Salvar Lista</button>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <div class="notification-icon">‚ÑπÔ∏è</div>
        <div class="notification-content">
            <div class="notification-title" id="notificationTitle">Informa√ß√£o</div>
            <div class="notification-message" id="notificationMessage">Mensagem</div>
        </div>
    </div>

    <script>
        // Elementos DOM
        const videoPlayer = document.getElementById('videoPlayer');
        const statusBadge = document.getElementById('statusBadge');
        const channelsList = document.getElementById('channelsList');
        const channelCount = document.getElementById('channelCount');
        const categoryFilter = document.getElementById('categoryFilter');
        const currentChannelTitle = document.getElementById('currentChannelTitle');
        const currentChannelDesc = document.getElementById('currentChannelDesc');
        const currentCategory = document.getElementById('currentCategory');
        const currentStatus = document.getElementById('currentStatus');
        const currentDuration = document.getElementById('currentDuration');
        const playBtn = document.getElementById('playBtn');
        const muteBtn = document.getElementById('muteBtn');
        const volumeSlider = document.getElementById('volumeSlider');
        const notification = document.getElementById('notification');
        const themeIcon = document.getElementById('themeIcon');
        const saveModal = document.getElementById('saveModal');
        const savedListsContainer = document.getElementById('savedListsContainer');

        // Lista de v√≠deos que REALMENTE funcionam
        const WORKING_STREAMS = [
            {
                name: "Big Buck Bunny (HD)",
                category: "Anima√ß√£o",
                url: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4",
                logo: "https://upload.wikimedia.org/wikipedia/commons/thumb/c/c5/Big_buck_bunny_poster_big.jpg/300px-Big_buck_bunny_poster_big.jpg",
                description: "Anima√ß√£o 3D open source famosa"
            },
            {
                name: "Elephants Dream",
                category: "Anima√ß√£o",
                url: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ElephantsDream.mp4",
                logo: "https://upload.wikimedia.org/wikipedia/en/thumb/7/7e/Elephants_Dream_%282006%29.jpg/300px-Elephants_Dream_%282006%29.jpg",
                description: "Primeiro filme open source"
            },
            {
                name: "For Bigger Blazes",
                category: "Teste",
                url: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerBlazes.mp4",
                logo: "https://via.placeholder.com/300x200/3498db/ffffff?text=Blazes",
                description: "V√≠deo de teste do Google"
            },
            {
                name: "For Bigger Escapes",
                category: "Teste",
                url: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerEscapes.mp4",
                logo: "https://via.placeholder.com/300x200/2ecc71/ffffff?text=Escapes",
                description: "V√≠deo de teste do Google"
            },
            {
                name: "For Bigger Fun",
                category: "Teste",
                url: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerFun.mp4",
                logo: "https://via.placeholder.com/300x200/e74c3c/ffffff?text=Fun",
                description: "V√≠deo de teste do Google"
            }
        ];

        // Dados da aplica√ß√£o
        let channels = [];
        let categories = new Set();
        let currentChannel = null;
        let currentListName = '';
        let savedLists = [];
        let currentListType = 'm3u';

        // Notifica√ß√µes
        function showNotification(title, message, type = 'info') {
            notification.className = `notification ${type}`;
            document.getElementById('notificationTitle').textContent = title;
            document.getElementById('notificationMessage').textContent = message;
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Alternar tema
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            themeIcon.textContent = document.body.classList.contains('dark-mode') ? '‚òÄÔ∏è' : 'üåô';
            saveToLocalStorage('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
        }

        // Alternar abas
        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.style.display = 'none');
            
            if (tab === 'm3u') {
                document.querySelector('.tab:nth-child(1)').classList.add('active');
                document.getElementById('m3uTab').style.display = 'block';
            } else if (tab === 'xtream') {
                document.querySelector('.tab:nth-child(2)').classList.add('active');
                document.getElementById('xtreamTab').style.display = 'block';
            } else {
                document.querySelector('.tab:nth-child(3)').classList.add('active');
                document.getElementById('savedTab').style.display = 'block';
                loadSavedLists();
            }
        }

        // Carregar demo funcional
        function loadDemo() {
            showNotification('üé¨', 'Carregando demo funcional...', 'info');
            
            channels = [...WORKING_STREAMS];
            categories = new Set(channels.map(c => c.category));
            currentListName = 'Demo Funcional';
            currentListType = 'demo';
            
            updateChannelsList();
            updateCategoryFilter();
            updateConnectionStatus(true);
            
            showNotification('‚úÖ Sucesso', `Demo carregada com ${channels.length} canais funcionais!`, 'success');
            
            // Selecionar primeiro canal
            setTimeout(() => {
                if (channels.length > 0) {
                    selectChannel(channels[0]);
                    const firstItem = document.querySelector('.channel-item');
                    if (firstItem) firstItem.classList.add('active');
                }
            }, 500);
        }

        // Carregar M3U do usu√°rio
        async function loadM3U() {
            const fileInput = document.getElementById('m3uFile');
            const urlInput = document.getElementById('m3uUrl').value;
            const listNameInput = document.getElementById('listName').value;
            
            if (!fileInput.files[0] && !urlInput) {
                showNotification('‚ö†Ô∏è Aviso', 'Selecione um arquivo ou insira uma URL', 'warning');
                return;
            }
            
            showNotification('‚è≥', 'Processando lista M3U...', 'info');
            
            try {
                let m3uContent = '';
                
                if (fileInput.files[0]) {
                    m3uContent = await readFile(fileInput.files[0]);
                } else {
                    // Usar proxy CORS
                    const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(urlInput)}`;
                    const response = await fetch(proxyUrl);
                    m3uContent = await response.text();
                }
                
                parseM3UContent(m3uContent);
                currentListName = listNameInput || 'Lista M3U';
                currentListType = 'm3u';
                
                showNotification('‚úÖ Sucesso', `Lista carregada com ${channels.length} canais`, 'success');
                
            } catch (error) {
                showNotification('‚ùå Erro', 'Falha ao carregar lista. Carregando demo...', 'error');
                loadDemo();
            }
        }

        // Salvar lista atual
        function saveCurrentList() {
            if (channels.length === 0) {
                showNotification('‚ö†Ô∏è Aviso', 'Carregue uma lista primeiro!', 'warning');
                return;
            }
            
            const listName = document.getElementById('listName').value || currentListName || 'Minha Lista';
            openSaveModal(listName, 'm3u');
        }

        // Salvar lista Xtream
        function saveXtreamList() {
            const listName = document.getElementById('xtreamListName').value || 'Lista Xtream';
            openSaveModal(listName, 'xtream');
        }

        // Abrir modal de salvamento
        function openSaveModal(defaultName = '', type = 'm3u') {
            document.getElementById('saveListName').value = defaultName;
            document.getElementById('saveListType').value = type;
            saveModal.classList.add('show');
        }

        // Fechar modal de salvamento
        function closeSaveModal() {
            saveModal.classList.remove('show');
        }

        // Confirmar salvamento da lista
        function confirmSaveList() {
            const listName = document.getElementById('saveListName').value;
            const listType = document.getElementById('saveListType').value;
            
            if (!listName.trim()) {
                showNotification('‚ö†Ô∏è Aviso', 'Digite um nome para a lista!', 'warning');
                return;
            }
            
            const listData = {
                id: Date.now().toString(),
                name: listName,
                type: listType,
                date: new Date().toISOString(),
                channels: channels,
                categories: Array.from(categories),
                source: listType === 'xtream' ? {
                    server: document.getElementById('serverUrl').value,
                    username: document.getElementById('username').value
                } : null
            };
            
            saveListToStorage(listData);
            closeSaveModal();
            showNotification('üíæ Salvo', `Lista "${listName}" salva com sucesso!`, 'success');
        }

        // Salvar lista no armazenamento local
        function saveListToStorage(listData) {
            savedLists = getFromLocalStorage('savedLists', []);
            
            // Verificar se j√° existe lista com mesmo nome
            const existingIndex = savedLists.findIndex(list => list.name === listData.name);
            if (existingIndex !== -1) {
                if (!confirm(`A lista "${listData.name}" j√° existe. Deseja substituir?`)) {
                    return;
                }
                savedLists[existingIndex] = listData;
            } else {
                savedLists.push(listData);
            }
            
            saveToLocalStorage('savedLists', savedLists);
            loadSavedLists();
        }

        // Carregar listas salvas
        function loadSavedLists() {
            savedLists = getFromLocalStorage('savedLists', []);
            savedListsContainer.innerHTML = '';
            
            if (savedLists.length === 0) {
                savedListsContainer.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: var(--gray);">
                        <p>Nenhuma lista salva ainda</p>
                        <p style="font-size: 0.9rem; margin-top: 0.5rem;">Salve suas listas para acess√°-las rapidamente!</p>
                    </div>
                `;
                return;
            }
            
            savedLists.forEach(list => {
                const listElement = document.createElement('div');
                listElement.className = 'saved-list-item';
                listElement.innerHTML = `
                    <div class="list-info">
                        <div class="list-name">${list.name}</div>
                        <div class="list-meta">
                            <span>üìÖ ${formatDate(list.date)}</span>
                            <span>üì∫ ${list.channels.length} canais</span>
                            <span>üè∑Ô∏è ${list.type === 'm3u' ? 'M3U' : list.type === 'xtream' ? 'Xtream' : 'Demo'}</span>
                        </div>
                    </div>
                    <div class="list-actions">
                        <button class="action-btn" onclick="loadSavedList('${list.id}')">‚ñ∂Ô∏è</button>
                        <button class="action-btn" onclick="exportList('${list.id}')">üì§</button>
                        <button class="action-btn" onclick="deleteList('${list.id}')">üóëÔ∏è</button>
                    </div>
                `;
                savedListsContainer.appendChild(listElement);
            });
        }

        // Carregar lista salva
        function loadSavedList(listId) {
            const list = savedLists.find(l => l.id === listId);
            if (!list) return;
            
            channels = list.channels;
            categories = new Set(list.categories);
            currentListName = list.name;
            currentListType = list.type;
            
            updateChannelsList();
            updateCategoryFilter();
            updateConnectionStatus(true);
            
            showNotification('üìÇ Carregado', `Lista "${list.name}" carregada com sucesso!`, 'success');
            
            // Voltar para aba M3U
            switchTab('m3u');
            
            // Selecionar primeiro canal
            setTimeout(() => {
                if (channels.length > 0) {
                    selectChannel(channels[0]);
                    const firstItem = document.querySelector('.channel-item');
                    if (firstItem) firstItem.classList.add('active');
                }
            }, 500);
        }

        // Exportar lista
        function exportList(listId) {
            const list = savedLists.find(l => l.id === listId);
            if (!list) return;
            
            // Gerar conte√∫do M3U
            let m3uContent = '#EXTM3U\n';
            list.channels.forEach(channel => {
                m3uContent += `#EXTINF:-1 tvg-id="${channel.name}" tvg-name="${channel.name}" tvg-logo="${channel.logo}" group-title="${channel.category}",${channel.name}\n`;
                m3uContent += `${channel.url}\n`;
            });
            
            // Criar e baixar arquivo
            const blob = new Blob([m3uContent], { type: 'audio/x-mpegurl' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${list.name.replace(/[^a-z0-9]/gi, '_')}.m3u`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('üì§ Exportado', `Lista "${list.name}" exportada com sucesso!`, 'success');
        }

        // Deletar lista
        function deleteList(listId) {
            const list = savedLists.find(l => l.id === listId);
            if (!list) return;
            
            if (confirm(`Tem certeza que deseja excluir a lista "${list.name}"?`)) {
                savedLists = savedLists.filter(l => l.id !== listId);
                saveToLocalStorage('savedLists', savedLists);
                loadSavedLists();
                showNotification('üóëÔ∏è Exclu√≠do', `Lista "${list.name}" exclu√≠da com sucesso!`, 'success');
            }
        }

        // Limpar todas as listas
        function clearAllLists() {
            if (savedLists.length === 0) {
                showNotification('‚ÑπÔ∏è Info', 'N√£o h√° listas para limpar', 'info');
                return;
            }
            
            if (confirm('Tem certeza que deseja excluir TODAS as listas salvas? Esta a√ß√£o n√£o pode ser desfeita.')) {
                savedLists = [];
                saveToLocalStorage('savedLists', []);
                loadSavedLists();
                showNotification('üóëÔ∏è Limpo', 'Todas as listas foram exclu√≠das', 'success');
            }
        }

        // Conectar Xtream (simula√ß√£o)
        function connectXtream() {
            const server = document.getElementById('serverUrl').value;
            const username = document.getElementById('username').value;
            
            if (!server || !username) {
                showNotification('‚ö†Ô∏è Aviso', 'Preencha todos os campos obrigat√≥rios', 'warning');
                return;
            }
            
            showNotification('üîå', 'Conectando ao servidor Xtream...', 'info');
            
            // Simular conex√£o
            setTimeout(() => {
                channels = WORKING_STREAMS.slice(0, 3).map(ch => ({
                    ...ch,
                    name: `[XTREAM] ${ch.name}`,
                    category: 'Xtream Demo'
                }));
                
                categories = new Set(['Xtream Demo']);
                updateChannelsList();
                updateCategoryFilter();
                updateConnectionStatus(true);
                
                showNotification('‚úÖ Conectado', 'Conex√£o Xtream simulada com sucesso', 'success');
            }, 1500);
        }

        // Parser M3U
        function parseM3UContent(content) {
            const lines = content.split('\n');
            channels = [];
            categories.clear();
            
            let currentChannel = null;
            
            for (let line of lines) {
                line = line.trim();
                
                if (line.startsWith('#EXTINF:')) {
                    currentChannel = parseExtinfLine(line);
                } else if (line && !line.startsWith('#') && currentChannel) {
                    currentChannel.url = line;
                    
                    // Substituir por URL funcional se necess√°rio
                    if (!isValidUrl(line)) {
                        currentChannel.url = WORKING_STREAMS[channels.length % WORKING_STREAMS.length].url;
                    }
                    
                    categories.add(currentChannel.category);
                    channels.push(currentChannel);
                    currentChannel = null;
                }
            }
            
            updateChannelsList();
            updateCategoryFilter();
            updateConnectionStatus(true);
        }

        function parseExtinfLine(line) {
            const channel = {
                name: 'Canal Desconhecido',
                category: 'Geral',
                url: '',
                logo: '',
                description: ''
            };
            
            // Extrair nome
            const nameMatch = line.match(/,(.+)$/);
            if (nameMatch) channel.name = nameMatch[1].trim();
            
            // Extrair atributos
            const attrRegex = /(\w+-?\w+)="([^"]*)"/g;
            let match;
            while (match = attrRegex.exec(line)) {
                if (match[1] === 'tvg-name' && !channel.name) {
                    channel.name = match[2];
                } else if (match[1] === 'group-title') {
                    channel.category = match[2] || 'Geral';
                } else if (match[1] === 'tvg-logo') {
                    channel.logo = match[2];
                }
            }
            
            return channel;
        }

        // Ler arquivo
        function readFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = e => resolve(e.target.result);
                reader.onerror = e => reject(e);
                reader.readAsText(file);
            });
        }

        // Validar URL
        function isValidUrl(string) {
            try {
                new URL(string);
                return true;
            } catch {
                return false;
            }
        }

        // Atualizar lista de canais
        function updateChannelsList(filteredChannels = channels) {
            channelsList.innerHTML = '';
            
            if (filteredChannels.length === 0) {
                channelsList.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: var(--gray);">
                        <p>Nenhum canal dispon√≠vel</p>
                        <p style="font-size: 0.9rem; margin-top: 0.5rem;">Clique em "CARREGAR DEMO FUNCIONAL"</p>
                    </div>
                `;
                channelCount.textContent = '0';
                return;
            }
            
            filteredChannels.forEach((channel, index) => {
                const channelElement = document.createElement('div');
                channelElement.className = 'channel-item';
                channelElement.onclick = () => selectChannel(channel);
                
                const logoText = channel.name.split(' ').map(w => w[0]).join('').toUpperCase().substring(0, 2);
                
                channelElement.innerHTML = `
                    <div class="channel-logo" style="background: ${getColorFromText(channel.name)}">
                        ${logoText}
                    </div>
                    <div class="channel-info">
                        <div class="channel-name">${channel.name}</div>
                        <div class="channel-category">${channel.category}</div>
                    </div>
                `;
                
                channelsList.appendChild(channelElement);
            });
            
            channelCount.textContent = filteredChannels.length;
        }

        // Atualizar filtro de categorias
        function updateCategoryFilter() {
            categoryFilter.innerHTML = '<option value="all">Todas categorias</option>';
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categoryFilter.appendChild(option);
            });
            
            categoryFilter.onchange = filterChannels;
        }

        // Filtrar canais
        function filterChannels() {
            const selectedCategory = categoryFilter.value;
            
            if (selectedCategory === 'all') {
                updateChannelsList(channels);
            } else {
                const filtered = channels.filter(c => c.category === selectedCategory);
                updateChannelsList(filtered);
            }
        }

        // Selecionar canal
        function selectChannel(channel) {
            currentChannel = channel;
            
            // Atualizar UI
            document.querySelectorAll('.channel-item').forEach(item => {
                item.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
            
            // Atualizar informa√ß√µes
            currentChannelTitle.textContent = channel.name;
            currentChannelDesc.textContent = channel.description || `Canal ${channel.category}`;
            currentCategory.textContent = `Categoria: ${channel.category}`;
            currentStatus.textContent = 'Status: Carregando...';
            currentDuration.textContent = 'Dura√ß√£o: -';
            
            // Reproduzir v√≠deo
            playChannel(channel);
        }

        // Reproduzir canal
        function playChannel(channel) {
            showNotification('‚ñ∂Ô∏è', `Carregando: ${channel.name}`, 'info');
            
            videoPlayer.src = channel.url;
            videoPlayer.load();
            
            videoPlayer.oncanplay = () => {
                currentStatus.textContent = 'Status: Pronto';
                videoPlayer.play().catch(e => {
                    console.log('Autoplay bloqueado:', e);
                    showNotification('‚ÑπÔ∏è', 'Clique em PLAY para iniciar', 'info');
                });
            };
            
            videoPlayer.onplaying = () => {
                currentStatus.textContent = 'Status: Reproduzindo';
                playBtn.textContent = '‚è∏Ô∏è';
                showNotification('‚úÖ', `Reproduzindo: ${channel.name}`, 'success');
            };
            
            videoPlayer.onerror = () => {
                currentStatus.textContent = 'Status: Erro';
                showNotification('‚ùå', 'Erro ao carregar v√≠deo. Tentando pr√≥ximo...', 'error');
                
                // Tentar pr√≥ximo canal
                const currentIndex = channels.findIndex(c => c === channel);
                const nextIndex = (currentIndex + 1) % channels.length;
                setTimeout(() => selectChannel(channels[nextIndex]), 2000);
            };
        }

        // Controles do player
        function playPause() {
            if (videoPlayer.paused) {
                videoPlayer.play();
                playBtn.textContent = '‚è∏Ô∏è';
            } else {
                videoPlayer.pause();
                playBtn.textContent = '‚ñ∂Ô∏è';
            }
        }

        function toggleMute() {
            videoPlayer.muted = !videoPlayer.muted;
            muteBtn.textContent = videoPlayer.muted ? 'üîá' : 'üîä';
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                videoPlayer.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }

        // Atualizar volume
        volumeSlider.oninput = () => {
            videoPlayer.volume = volumeSlider.value;
        };

        // Atualizar status de conex√£o
        function updateConnectionStatus(connected) {
            statusBadge.className = connected ? 'status-badge connected' : 'status-badge disconnected';
            statusBadge.innerHTML = `<span>‚óè</span> ${connected ? 'Conectado' : 'Desconectado'}`;
        }

        // Fun√ß√µes auxiliares
        function getColorFromText(text) {
            const colors = [
                '#3498db', '#2ecc71', '#e74c3c', '#9b59b6', '#1abc9c',
                '#f39c12', '#d35400', '#c0392b', '#8e44ad', '#16a085'
            ];
            let hash = 0;
            for (let i = 0; i < text.length; i++) {
                hash = text.charCodeAt(i) + ((hash << 5) - hash);
            }
            return colors[Math.abs(hash) % colors.length];
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('pt-BR', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
        }

        // Local Storage
        function saveToLocalStorage(key, value) {
            try {
                localStorage.setItem(key, JSON.stringify(value));
            } catch (e) {
                console.error('Erro ao salvar no localStorage:', e);
            }
        }

        function getFromLocalStorage(key, defaultValue) {
            try {
                const item = localStorage.getItem(key);
                return item ? JSON.parse(item) : defaultValue;
            } catch (e) {
                console.error('Erro ao ler do localStorage:', e);
                return defaultValue;
            }
        }

        // Inicializar
        function init() {
            updateConnectionStatus(false);
            
            // Carregar tema salvo
            const savedTheme = getFromLocalStorage('theme', 'light');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
                themeIcon.textContent = '‚òÄÔ∏è';
            }
            
            // Carregar listas salvas
            loadSavedLists();
            
            // Configurar eventos do player
            videoPlayer.onvolumechange = () => {
                volumeSlider.value = videoPlayer.volume;
                muteBtn.textContent = videoPlayer.muted ? 'üîá' : 'üîä';
            };
            
            showNotification('üé¨ IPTV Player Pro', 'Clique em "CARREGAR DEMO FUNCIONAL" para come√ßar!', 'info');
        }

        // Iniciar quando a p√°gina carregar
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
